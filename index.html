<!doctype html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div id="main"></div>
  <script src="elm.js"></script>
  <script>

    var node = document.getElementById('main')
    var app = Elm.Main.embed(node)

    app.ports.pauseUnpause.subscribe(function(audioId) {
      var audio = document.getElementById(audioId)
      if (audio.paused) {
        audio.play()
      } else {
        audio.pause()
      }
    })

    app.ports.seek.subscribe(function(audioIdAndAmount) {
      var audioId = audioIdAndAmount[0]
      var amount = audioIdAndAmount[1]
      var audio = document.getElementById(audioId)
      audio.currentTime += amount
    })

    app.ports.setUrl.subscribe(function(audioIdAndUrl) {
      var audioId = audioIdAndUrl[0]
      var url = audioIdAndUrl[1]
      var audio = document.getElementById(audioId)
      audio.src = url

      audio.ontimeupdate = function() {
        app.ports.timeStamp.send(Math.floor(audio.currentTime))
      }

      audio.oncanplay = function() {
        app.ports.isReady.send(true)
      }

      audio.onerror = function() {
        app.ports.isReady.send(false)
      }

      audio.onpause = function() {
        app.ports.paused.send(null)
      }

      audio.onplay = function() {
        app.ports.played.send(null)
      }
    })

    

  </script>
</body>
